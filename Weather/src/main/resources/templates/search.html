<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">
<head>
    <meta charset="UTF-8">
    <title>How is the Weather</title>

    <!-- Tailwind Safelist ì„¤ì • -->
    <script>
        tailwind.config = {
            safelist: [
                "text-pink-500",
                "text-rose-500",
                "text-orange-500",
                "text-sky-500",
                "text-[#0ea5e9]"
            ]
        }
    </script>

    <!-- Tailwind CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<!-- ë°°ê²½ -->
<body th:class="'min-h-screen flex items-center justify-center ' + ${seasonBgClass}">
<div class="w-full max-w-5xl mx-auto bg-white shadow-lg rounded-3xl px-10 py-10">

    <!-- ìƒë‹¨ íƒ€ì´í‹€ -->
    <header class="text-center mb-8">
        <h1 class="text-5xl font-black leading-tight">
        <span class="block">
            <!-- H ë§Œ ê³„ì ˆ ìƒ‰ìƒ -->
            <span th:class="${seasonTitleClass}">H</span><span class="text-slate-900">ow </span>
            <!-- i ë§Œ ê³„ì ˆ ìƒ‰ìƒ -->
            <span th:class="${seasonTitleClass}">i</span><span class="text-slate-900">s the</span>
        </span>

            <span class="block">
            <!-- Weather ì „ì²´ë¥¼ ê³„ì ˆ ìƒ‰ìƒ -->
            <span th:class="${seasonTitleClass}">Weather</span>
        </span>
        </h1>

        <p class="mt-2 tracking-[0.3em] text-xs text-slate-500">
            PLAN TOUR DAY
        </p>
    </header>


    <!-- ğŸ” ê²€ìƒ‰ ì˜ì—­ + ìë™ì™„ì„± -->
    <section class="flex justify-center mb-10">
        <div class="relative w-96">
            <form id="search-form" th:action="@{/search}" method="get" class="flex gap-2">
                <input
                        id="search-input"
                        type="text"
                        name="q"
                        th:value="${keyword}"
                        placeholder="ì˜ˆ) ì„œìš¸, ì¢…ë¡œ, ì¸ì²œ ì„œêµ¬"
                        class="w-96 px-4 py-2 border border-slate-300 rounded-lg text-sm
                               focus:outline-none focus:ring-2 focus:ring-[#8ac8ff] focus:border-[#8ac8ff]"
                        autocomplete="off"
                />
                <button
                        type="submit"
                        class="w-24 py-2 text-sm font-semibold bg-slate-800 text-white rounded-lg
                               hover:bg-slate-900 transition">
                    ê²€ìƒ‰
                </button>
            </form>

            <!-- â–¼ ìë™ì™„ì„± ë“œë¡­ë‹¤ìš´ -->
            <ul id="suggest-list"
                class="absolute z-10 mt-1 w-full bg-white border border-slate-200 rounded-lg shadow
                       text-sm max-h-60 overflow-y-auto hidden">
                <!-- JS ë¡œ ì±„ì›Œì§ -->
            </ul>
        </div>
    </section>

    <!-- ë©”ì¸ 3ê°œ ì¹´ë“œ -->
    <section class="grid grid-cols-1 md:grid-cols-3 gap-6">

        <!-- ì¹´ë“œ 1: ì˜¤ëŠ˜ì˜ ë‚ ì”¨ëŠ”? -->
        <!-- ì„ íƒëœ ì§€ì—­ì´ ìˆì„ ë•Œ: /region/{city}/{district} ë¡œ ì´ë™ -->
        <a th:if="${selectedRegion != null}"
           th:href="@{/region/{city}/{district}(
                        city=${selectedRegion.parentRegion},
                        district=${selectedRegion.childRegion}
                    )}"
           class="block border border-slate-300 rounded-xl bg-white hover:shadow-md transition">
            <div class="p-4 flex flex-col items-center">
                <h2 class="mb-3 text-lg font-semibold">ì˜¤ëŠ˜ì˜ ë‚ ì”¨ëŠ”?</h2>

                <img th:src="@{/images/icons/seasons_bird/{file}(file=${seasonBirdImage})}"
                     alt="ê³„ì ˆ ìƒˆ"
                     class="mt-1 w-40 h-40 object-contain mb-3">

                <p class="text-xs text-slate-500 text-center leading-relaxed">
                    í´ë¦­í•˜ë©´ ì˜¤ëŠ˜ ë‚ ì”¨ì™€ ì˜·ì°¨ë¦¼ì„ ë³´ì—¬ì¤˜ìš”
                </p>
                <p class="mt-2 text-xs text-slate-400 text-center leading-relaxed"
                   th:text="${selectedRegion.parentRegion} + ' ' + ${selectedRegion.childRegion} + ' ê¸°ì¤€'">
                </p>
            </div>
        </a>

        <!-- ì„ íƒëœ ì§€ì—­ì´ ì—†ì„ ë•Œ: ë§í¬ ì—†ì´ ì•ˆë‚´ë§Œ -->
        <div th:if="${selectedRegion == null}"
             class="block border border-slate-300 rounded-xl bg-white">
            <div class="p-4 flex flex-col items-center">
                <h2 class="mb-3 text-lg font-semibold">ì˜¤ëŠ˜ì˜ ë‚ ì”¨ëŠ”?</h2>

                <img th:src="@{/images/icons/seasons_bird/{file}(file=${seasonBirdImage})}"
                     alt="ê³„ì ˆ ìƒˆ"
                     class="mt-1 w-40 h-40 object-contain mb-3">

                <p class="mt-3 text-xs text-slate-500 text-center">
                    ìœ„ ê²€ìƒ‰ì°½ì— ì§€ì—­ì„ ì…ë ¥í•˜ë©´<br>í•´ë‹¹ ì§€ì—­ ê¸°ì¤€ìœ¼ë¡œ ë‚ ì”¨ë¥¼ ë³´ì—¬ì¤˜ìš”
                </p>
            </div>
        </div>

        <!-- ì¹´ë“œ 2: ì§€ê¸ˆì˜ ì ˆê¸°ëŠ”? -->
        <div class="block border border-slate-300 rounded-xl bg-white cursor-default">
            <div class="p-4 flex flex-col items-center">
                <h2 class="mb-3 text-lg font-semibold">ì§€ê¸ˆì˜ ì ˆê¸°ëŠ”?</h2>

                <img th:src="@{/images/icons/solar_term/sun.png}"
                     alt="ì ˆê¸° ì•„ì´ì½˜"
                     class="w-40 h-40 object-contain mb-3">

                <div class="flex flex-col items-center text-center text-xs leading-tight">
                    <p class="text-slate-500">
                        ğŸŒ í˜„ì¬ ì ˆê¸° : <span th:text="${solarTerm}"></span>
                    </p>
                    <p class="text-slate-400 whitespace-pre-line -mt-0.5">
                        <span th:text="${solarTermDesc}"></span>
                    </p>
                </div>

            </div>
        </div>

        <!-- ì¹´ë“œ 3: ì˜¤ëŠ˜ì˜ ë¬¸êµ¬ -->
        <div class="block border border-slate-300 rounded-xl bg-white cursor-default">
            <div class="p-4 flex flex-col items-center">
                <h2 class="mb-6 text-lg font-semibold">ì˜¤ëŠ˜ì˜ ë¬¸êµ¬</h2>

                <div th:class="'w-48 min-h-[150px] flex items-center justify-center mb-4
                rounded-xl border-2 px-4 py-3 text-center shadow-sm '
                + ${memoBoxClass}">
                    <span class="text-base text-slate-800 leading-relaxed font-medium whitespace-pre-line"
                          th:text="${todayMemo}">ëœë¤ ë¬¸êµ¬
                    </span>
                </div>

                <p class="mt-3 text-xs text-slate-500 text-center">
                    ì˜¤ëŠ˜ í•˜ë£¨ë¥¼ ìœ„í•œ ì‘ì€ í•œ ì¤„ì´ì—ìš”
                </p>
            </div>
        </div>
    </section>
</div>

<!-- ğŸ”§ ìë™ì™„ì„± JS -->
<script>
    document.addEventListener("DOMContentLoaded", function () {
        const input = document.getElementById("search-input");
        const list = document.getElementById("suggest-list");

        if (!input || !list) {
            console.log("ê²€ìƒ‰ input ë˜ëŠ” suggest-listë¥¼ ì°¾ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.");
            return;
        }

        let lastQuery = "";

        input.addEventListener("input", async () => {
            const q = input.value.trim();

            if (q.length === 0) {
                list.classList.add("hidden");
                list.innerHTML = "";
                lastQuery = "";
                return;
            }

            if (q === lastQuery) return;
            lastQuery = q;

            try {
                const resp = await fetch("/search/suggest?q=" + encodeURIComponent(q));
                console.log("suggest status:", resp.status);

                if (!resp.ok) {
                    list.classList.add("hidden");
                    return;
                }

                const data = await resp.json();
                console.log("suggest data:", data);

                list.innerHTML = "";

                if (!Array.isArray(data) || data.length === 0) {
                    list.classList.add("hidden");
                    return;
                }

                data.forEach(item => {
                    const li = document.createElement("li");
                    li.textContent = `${item.parentRegion} ${item.childRegion}`;
                    li.className = "px-3 py-1 cursor-pointer bg-white hover:bg-slate-100";

                    li.addEventListener("click", () => {
                        input.value = li.textContent;
                        list.classList.add("hidden");
                        list.innerHTML = "";

                        const form = document.getElementById("search-form");
                        if (form) {
                            form.submit();
                        }
                    });

                    list.appendChild(li);
                });

                list.classList.remove("hidden");
            } catch (e) {
                console.error("suggest error:", e);
                list.classList.add("hidden");
            }
        });

        document.addEventListener("click", (e) => {
            if (e.target !== input && !list.contains(e.target)) {
                list.classList.add("hidden");
            }
        });
    });
</script>

</body>
</html>
